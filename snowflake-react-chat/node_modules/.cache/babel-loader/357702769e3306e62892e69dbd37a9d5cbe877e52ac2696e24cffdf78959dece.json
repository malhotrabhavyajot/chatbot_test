{"ast":null,"code":"import _objectSpread from\"/workspaces/chatbot_test/snowflake-react-chat/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from'react';import'../styles/style.css';import ChatbotIcon from'../assets/chatbot-toggler.png';import ZSIcon from'../assets/ZS_Associates.png';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const HARDCODED_ANSWERS={\"where can i find top 10 gainer prescriber over time?\":\"Top 10 Gainer Prescribers can be found in the Performance Dossier.\",\"what is formulary status?\":\"Formulary Status is the 'MMIT Pharmacy field which shows Preferred/Covered combined with PA/ST Restrictions.\",\"what are the number of current monthly suggestion kpi?\":\"It is the 'Count of monthly suggestions (Call and RTE) for a prescriber.\",\"which dossier gives a detailed analysis about the payors?\":\"You can find detailed analysis about Payor data in the Payor Highlights dossier.\",\"where can i find explanations about different kpis?\":\"Explanations and Calculation of each and every KPI can be found in the Glossary dossier.\",\"what is mkt % lis?\":\"Mkt % LIS in the Percentage of claims where claim type is 'PAID' and channel is 'Medicare' and 'Medicare D', and OPC = $0 - $12 and LIS patient flag = LIS-DE , LIS LTC, LIS-NON-DE, LIS-UNKNOWN for Rolling 3M.\",\"which universes do we show in accounts calculation?\":\"We show three universes Veeva Aligned, Call Plan/DMCP and a combined Veeva Aligned + Call Plan/DMCP universes.\",\"where can i find trx sales trends overtime?\":\"The sales trends for Retail and Non Retail sales can be found in the Performance Dossier.\"};const HARDCODED_SUGGESTIONS=[\"Which universes do we show in Accounts calculation?\",\"Where can I find TRX Sales trends overtime?\",\"Where can I find top 10 Gainer Prescriber over time?\",\"What is Formulary Status?\"];const GENERIC_GREETINGS=[\"hi\",\"hello\",\"hey\",\"how are you\",\"good morning\",\"good afternoon\",\"good evening\",\"hiya\",\"yo\",\"hii\",\"hello there\",\"hey there\",\"hi there\"];function isGreeting(text){const cleaned=text.trim().toLowerCase();return GENERIC_GREETINGS.some(g=>cleaned===g||cleaned.startsWith(g+' '));}function formatSnowflakeResponse(responseText){try{let json=JSON.parse(responseText);if(json.resultSetMetaData&&json.resultSetMetaData.rowType&&json.resultSetMetaData.rowType.length===1&&/^CUSTOM_AGENT/i.test(json.resultSetMetaData.rowType[0].name)&&Array.isArray(json.data)&&json.data.length>0&&json.data[0][0]){try{const cellValue=json.data[0][0];const agentObj=JSON.parse(cellValue);if(typeof agentObj.output===\"string\"){return{type:\"output\",value:agentObj.output};}}catch(e){return{type:\"output\",value:json.data[0][0]};}}const agentKey=Object.keys(json).find(key=>key.startsWith(\"CUSTOM_AGENT\"));if(agentKey&&typeof json[agentKey]===\"string\"){try{const agentObj=JSON.parse(json[agentKey]);if(typeof agentObj.output===\"string\"){return{type:\"output\",value:agentObj.output};}return{type:\"json\",value:agentObj};}catch(_unused){return{type:\"output\",value:json[agentKey]};}}const columns=json.resultSetMetaData&&json.resultSetMetaData.rowType&&json.resultSetMetaData.rowType.map(col=>col.name)||json.rowType&&json.rowType.map(col=>col.name)||json.rowtype&&json.rowtype.map(col=>col.name)||json.columns&&json.columns.map(col=>col.name);const data=json.data;if(Array.isArray(columns)&&columns.length>0&&Array.isArray(data)){return{type:\"table\",columns,data};}if(json.error)return{type:\"error\",value:\"‚ùå Error: \"+json.error};if(json.code&&json.code!==\"000000\"&&(!json.message||!json.message.toLowerCase().includes(\"executed successfully\"))){return{type:\"error\",value:\"\\u274C Error: \".concat(json.code,\" - \").concat(json.message)};}if(json.message)return{type:\"output\",value:json.message};return{type:\"output\",value:\"No data found.\"};}catch(_unused2){return{type:\"error\",value:responseText||\"No response from Snowflake.\"};}}// --- Typing Indicator Component ---\nfunction TypingIndicator(){return/*#__PURE__*/_jsxs(\"span\",{className:\"typing-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]});}// Tooltip helper\nconst Tooltip=_ref=>{let{children,text}=_ref;return/*#__PURE__*/_jsxs(\"span\",{className:\"feedback-tooltip\",children:[children,/*#__PURE__*/_jsx(\"span\",{className:\"feedback-tooltiptext\",children:text})]});};const ChatBot=()=>{const[messages,setMessages]=useState(()=>{const saved=localStorage.getItem('chatMessages');if(saved)return JSON.parse(saved);return[{role:'assistant',text:'Hello üëã! How may I assist you?'}];});const[feedback,setFeedback]=useState({});const[suggestionIndex,setSuggestionIndex]=useState(()=>{const stored=localStorage.getItem('suggestionIndex');return stored?parseInt(stored,10):0;});const[input,setInput]=useState('');const[isOpen,setIsOpen]=useState(false);const[darkMode,setDarkMode]=useState(false);const[isExpanded,setIsExpanded]=useState(false);const[toast,setToast]=useState({message:'',type:'info',visible:false});const[clickedIndex,setClickedIndex]=useState(null);const[isTyping,setIsTyping]=useState(false);const chatRef=useRef();const inputRef=useRef();// Suggestion randomizer for clear chat\nconst randomizeSuggestions=()=>{let newIndex=Math.floor(Math.random()*HARDCODED_SUGGESTIONS.length);if(HARDCODED_SUGGESTIONS.length>1&&newIndex===suggestionIndex){newIndex=(newIndex+1)%HARDCODED_SUGGESTIONS.length;}setSuggestionIndex(newIndex);localStorage.setItem('suggestionIndex',newIndex.toString());};// 2 or 4 suggestions based on expansion\nconst numSuggestions=isExpanded?4:2;const visibleSuggestions=Array(numSuggestions).fill(0).map((_,i)=>HARDCODED_SUGGESTIONS[(suggestionIndex+i)%HARDCODED_SUGGESTIONS.length]);// Scroll chat to bottom on update\nuseEffect(()=>{var _chatRef$current;(_chatRef$current=chatRef.current)===null||_chatRef$current===void 0?void 0:_chatRef$current.scrollTo({top:chatRef.current.scrollHeight,behavior:'smooth'});},[messages,isTyping,isOpen,isExpanded]);// Prevent input scrolling\nuseEffect(()=>{if(inputRef.current){inputRef.current.scrollLeft=inputRef.current.value.length*8;}},[input]);// Auto-hide toast\nuseEffect(()=>{if(toast.visible){const timer=setTimeout(()=>{setToast(t=>_objectSpread(_objectSpread({},t),{},{visible:false}));},1500);return()=>clearTimeout(timer);}},[toast.visible]);const showToast=(msg,type)=>{setToast({message:msg,type:type,visible:true});};const handleSendMessage=async userMessage=>{if(!userMessage.trim())return;const newMessages=[...messages,{role:'user',text:userMessage}];setMessages(newMessages);localStorage.setItem('chatMessages',JSON.stringify(newMessages));setInput('');setIsTyping(true);if(isGreeting(userMessage)){const greetingResponse=\"Hello! üëã How can I assist you with your field insights or business data today?\";setTimeout(()=>{setIsTyping(false);const updatedMessages=[...newMessages,{role:'assistant',text:greetingResponse}];setMessages(updatedMessages);localStorage.setItem('chatMessages',JSON.stringify(updatedMessages));},700);return;}// HARDCODED business mode answers\nconst cleaned=userMessage.trim().toLowerCase();const matchedKey=Object.keys(HARDCODED_ANSWERS).find(k=>cleaned.includes(k));if(matchedKey){const hardcodedAnswer=HARDCODED_ANSWERS[matchedKey];setTimeout(()=>{setIsTyping(false);const updatedMessages=[...newMessages,{role:'assistant',text:hardcodedAnswer}];setMessages(updatedMessages);localStorage.setItem('chatMessages',JSON.stringify(updatedMessages));},650);return;}// Show typing indicator (no pending message in chat)\nconst isLikelySQL=userMessage.trim().toLowerCase().startsWith('select')||userMessage.trim().toLowerCase().startsWith('show')||userMessage.trim().toLowerCase().startsWith('desc')||userMessage.trim().toLowerCase().startsWith('describe');try{let body=isLikelySQL?{statement:userMessage}:{statement:\"CALL CUSTOM_AGENT2('\".concat(userMessage.replace(/'/g,\"''\"),\"');\")};const response=await fetch('http://localhost:4000/api/snowflake',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const responseText=await response.text();const formatted=formatSnowflakeResponse(responseText);setIsTyping(false);const updatedMessages=[...newMessages,{role:'assistant',text:formatted}];setMessages(updatedMessages);localStorage.setItem('chatMessages',JSON.stringify(updatedMessages));}catch(err){setIsTyping(false);const formatted={type:\"error\",value:\"‚ö†Ô∏è Unable to connect to backend.\"};const updatedMessages=[...newMessages,{role:'assistant',text:formatted}];setMessages(updatedMessages);localStorage.setItem('chatMessages',JSON.stringify(updatedMessages));}};const handleFeedback=(idx,type)=>{setFeedback(prev=>_objectSpread(_objectSpread({},prev),{},{[idx]:type}));showToast(type===\"up\"?\"Marked as helpful!\":\"Marked as not helpful!\",type===\"up\"?\"success\":\"error\");};const toggleTheme=()=>setDarkMode(prev=>!prev);// Render assistant output\nconst renderChatBubbleContent=msg=>{if(typeof msg.text===\"object\"&&msg.text!==null){const obj=msg.text;if(obj.type===\"table\"){return/*#__PURE__*/_jsxs(\"table\",{className:\"snowflake-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsx(\"tr\",{children:obj.columns.map((h,i)=>/*#__PURE__*/_jsx(\"th\",{children:h},i))})}),/*#__PURE__*/_jsx(\"tbody\",{children:obj.data.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:obj.columns.length,style:{textAlign:'center',color:'#888'},children:\"(no results)\"})}):obj.data.map((row,ridx)=>/*#__PURE__*/_jsx(\"tr\",{children:row.map((cell,cidx)=>/*#__PURE__*/_jsx(\"td\",{style:{whiteSpace:'pre-wrap',fontFamily:typeof cell===\"string\"&&cell.trim().startsWith('[')?\"monospace\":undefined},children:(()=>{try{if(typeof cell===\"string\"&&(cell.trim().startsWith('[')||cell.trim().startsWith('{'))){const parsed=JSON.parse(cell);if(Array.isArray(parsed)){return/*#__PURE__*/_jsx(\"ul\",{style:{paddingLeft:'18px',margin:0},children:parsed.map((item,idx)=>/*#__PURE__*/_jsx(\"li\",{children:item},idx))});}if(typeof parsed==='object'){return/*#__PURE__*/_jsx(\"pre\",{children:JSON.stringify(parsed,null,2)});}}return cell;}catch(_unused3){return cell;}})()},cidx))},ridx))})]});}if(obj.type===\"output\"){return/*#__PURE__*/_jsx(\"div\",{children:obj.value});}if(obj.type===\"error\"){return/*#__PURE__*/_jsx(\"span\",{style:{color:\"#b91c1c\",fontWeight:500},children:obj.value});}return/*#__PURE__*/_jsx(\"pre\",{children:JSON.stringify(obj.value,null,2)});}return(msg.text||\"\").split('\\n').map((line,i)=>/*#__PURE__*/_jsx(\"div\",{children:line},i));};// Suggestion button microinteraction\nconst handleSuggestionClick=(s,i,e)=>{setClickedIndex(i);setTimeout(()=>setClickedIndex(null),220);handleSendMessage(s);};// Main render\nreturn/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(to bottom right, #f7faff, #e2ecf4)',minHeight:'100vh'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"chatbot-toggler modern-toggler\",onClick:()=>setIsOpen(!isOpen),\"aria-label\":\"Toggle chatbot\",style:{position:'fixed',right:'20px',bottom:'20px',zIndex:10000},children:isOpen?'‚úñ':/*#__PURE__*/_jsx(\"img\",{src:ChatbotIcon,alt:\"Chatbot\",style:{width:48,height:48}})}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot modern-chatbot\"+(darkMode?' dark-mode':'')+(isExpanded?' expanded':' collapsed'),children:[/*#__PURE__*/_jsxs(\"header\",{className:\"chatbot-header\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"header-title\",children:[\"Field Insights\",/*#__PURE__*/_jsx(\"span\",{className:\"header-title-gradient\",children:\" Assistant\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"header-controls\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleTheme,title:\"Toggle theme\",className:\"header-action-btn\",\"aria-label\":\"Toggle theme\",children:darkMode?/*#__PURE__*/_jsxs(\"svg\",{width:\"25\",height:\"25\",viewBox:\"0 0 24 24\",fill:\"none\",children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"12\",cy:\"12\",r:\"5\",fill:\"#7c3aed\"}),/*#__PURE__*/_jsxs(\"g\",{stroke:\"#7c3aed\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"2\",x2:\"12\",y2:\"5\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"19\",x2:\"12\",y2:\"22\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"4.22\",y1:\"4.22\",x2:\"6.34\",y2:\"6.34\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"17.66\",y1:\"17.66\",x2:\"19.78\",y2:\"19.78\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"2\",y1:\"12\",x2:\"5\",y2:\"12\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"19\",y1:\"12\",x2:\"22\",y2:\"12\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"4.22\",y1:\"19.78\",x2:\"6.34\",y2:\"17.66\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"17.66\",y1:\"6.34\",x2:\"19.78\",y2:\"4.22\"})]})]}):/*#__PURE__*/_jsx(\"svg\",{width:\"25\",height:\"25\",viewBox:\"0 0 24 24\",fill:\"none\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M21 12.79A9 9 0 1111.21 3a7 7 0 0010.02 9.79z\",fill:\"#7c3aed\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{randomizeSuggestions();setMessages([{role:'assistant',text:'Hello üëã! How may I assist you?'}]);localStorage.removeItem('chatMessages');setFeedback({});},title:\"Clear chat\",className:\"header-action-btn\",\"aria-label\":\"Clear chat\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"25\",height:\"25\",fill:\"none\",stroke:\"#7c3aed\",strokeWidth:\"2.1\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M4.93 4.93a10 10 0 1014.14 0M23 4v6h-6\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsExpanded(prev=>!prev),title:isExpanded?'Collapse window':'Expand window',className:\"header-action-btn\",\"aria-label\":isExpanded?'Collapse window':'Expand window',children:isExpanded?/*#__PURE__*/_jsxs(\"svg\",{width:\"25\",height:\"25\",fill:\"none\",stroke:\"#7c3aed\",strokeWidth:\"2.1\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"polyline\",{points:\"8 3 3 3 3 8\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"3\",y1:\"3\",x2:\"10\",y2:\"10\"}),/*#__PURE__*/_jsx(\"polyline\",{points:\"16 21 21 21 21 16\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"21\",y1:\"21\",x2:\"14\",y2:\"14\"})]}):/*#__PURE__*/_jsxs(\"svg\",{width:\"25\",height:\"25\",fill:\"none\",stroke:\"#7c3aed\",strokeWidth:\"2.1\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"polyline\",{points:\"15 3 21 3 21 9\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"21\",y1:\"3\",x2:\"14\",y2:\"10\"}),/*#__PURE__*/_jsx(\"polyline\",{points:\"9 21 3 21 3 15\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"3\",y1:\"21\",x2:\"10\",y2:\"14\"})]})})]})})]}),/*#__PURE__*/_jsxs(\"ul\",{className:\"chatbox\",ref:chatRef,children:[messages.map((msg,idx)=>/*#__PURE__*/_jsxs(\"li\",{className:\"chat \".concat(msg.role==='user'?'outgoing':'incoming'),style:{justifyContent:msg.role==='user'?'flex-end':'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-bubble \".concat(msg.role),children:renderChatBubbleContent(msg)}),msg.role==='assistant'&&/*#__PURE__*/_jsxs(\"div\",{className:\"feedback-row\",children:[feedback[idx]===undefined&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{text:\"Mark as helpful\",children:/*#__PURE__*/_jsx(\"button\",{className:\"feedback-btn\",onClick:()=>handleFeedback(idx,'up'),\"aria-label\":\"Thumbs up\",tabIndex:0,children:\"\\uD83D\\uDC4D\"})}),/*#__PURE__*/_jsx(Tooltip,{text:\"Mark as not helpful\",children:/*#__PURE__*/_jsx(\"button\",{className:\"feedback-btn\",onClick:()=>handleFeedback(idx,'down'),\"aria-label\":\"Thumbs down\",tabIndex:0,children:\"\\uD83D\\uDC4E\"})})]}),feedback[idx]==='up'&&/*#__PURE__*/_jsx(Tooltip,{text:\"Marked as helpful!\",children:/*#__PURE__*/_jsx(\"button\",{className:\"feedback-btn selected up\",\"aria-label\":\"Thumbs up\",tabIndex:0,children:\"\\uD83D\\uDC4D\"})}),feedback[idx]==='down'&&/*#__PURE__*/_jsx(Tooltip,{text:\"Marked as not helpful\",children:/*#__PURE__*/_jsx(\"button\",{className:\"feedback-btn selected down\",\"aria-label\":\"Thumbs down\",tabIndex:0,children:\"\\uD83D\\uDC4E\"})})]})]},idx)),isTyping&&/*#__PURE__*/_jsx(\"li\",{className:\"chat incoming\",children:/*#__PURE__*/_jsx(\"div\",{className:\"chat-bubble assistant\",children:/*#__PURE__*/_jsx(TypingIndicator,{})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"suggestions\",style:{position:\"relative\"},children:[visibleSuggestions.map((s,i)=>/*#__PURE__*/_jsx(\"button\",{onClick:e=>handleSuggestionClick(s,i,e),className:\"suggestion-button\".concat(clickedIndex===i?' clicked':''),children:s},i)),!isExpanded&&/*#__PURE__*/_jsx(\"button\",{className:\"suggestion-arrow right\",\"aria-label\":\"Next suggestions\",onClick:()=>{const max=HARDCODED_SUGGESTIONS.length;setSuggestionIndex(prev=>(prev+1)%max);localStorage.setItem(\"suggestionIndex\",((suggestionIndex+1)%max).toString());},style:{border:\"none\",background:\"none\",cursor:\"pointer\",fontSize:20,marginLeft:7,color:\"#7c3aed\",alignSelf:\"center\",height:28,width:28},children:\"\\u2192\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-input\",children:[/*#__PURE__*/_jsx(\"textarea\",{ref:inputRef,placeholder:\"Ask me anything...\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>e.key==='Enter'&&!e.shiftKey&&handleSendMessage(input),rows:1,className:\"chat-input-textarea\",style:{overflow:'hidden',resize:'none'}}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendMessage(input),title:\"Send message\",className:\"send-button\".concat(input.trim()?\" has-text\":\"\"),children:/*#__PURE__*/_jsx(\"svg\",{height:\"22\",width:\"22\",viewBox:\"0 0 24 24\",fill:\"none\",style:{display:\"block\"},children:/*#__PURE__*/_jsx(\"path\",{d:\"M4 20L20 12L4 4V10L16 12L4 14V20Z\",fill:\"currentColor\"})})})]}),toast.visible&&/*#__PURE__*/_jsx(\"div\",{className:\"toast toast-\".concat(toast.type),onClick:()=>setToast(t=>_objectSpread(_objectSpread({},t),{},{visible:false})),style:{cursor:'pointer'},children:toast.message}),/*#__PURE__*/_jsxs(\"footer\",{className:\"chatbot-footer\",children:[\"Powered by \",/*#__PURE__*/_jsx(\"img\",{src:ZSIcon,alt:\"ZS Associates\"})]})]})]});};export default ChatBot;","map":{"version":3,"names":["React","useEffect","useRef","useState","ChatbotIcon","ZSIcon","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HARDCODED_ANSWERS","HARDCODED_SUGGESTIONS","GENERIC_GREETINGS","isGreeting","text","cleaned","trim","toLowerCase","some","g","startsWith","formatSnowflakeResponse","responseText","json","JSON","parse","resultSetMetaData","rowType","length","test","name","Array","isArray","data","cellValue","agentObj","output","type","value","e","agentKey","Object","keys","find","key","_unused","columns","map","col","rowtype","error","code","message","includes","concat","_unused2","TypingIndicator","className","children","Tooltip","_ref","ChatBot","messages","setMessages","saved","localStorage","getItem","role","feedback","setFeedback","suggestionIndex","setSuggestionIndex","stored","parseInt","input","setInput","isOpen","setIsOpen","darkMode","setDarkMode","isExpanded","setIsExpanded","toast","setToast","visible","clickedIndex","setClickedIndex","isTyping","setIsTyping","chatRef","inputRef","randomizeSuggestions","newIndex","Math","floor","random","setItem","toString","numSuggestions","visibleSuggestions","fill","_","i","_chatRef$current","current","scrollTo","top","scrollHeight","behavior","scrollLeft","timer","setTimeout","t","_objectSpread","clearTimeout","showToast","msg","handleSendMessage","userMessage","newMessages","stringify","greetingResponse","updatedMessages","matchedKey","k","hardcodedAnswer","isLikelySQL","body","statement","replace","response","fetch","method","headers","formatted","err","handleFeedback","idx","prev","toggleTheme","renderChatBubbleContent","obj","h","colSpan","style","textAlign","color","row","ridx","cell","cidx","whiteSpace","fontFamily","undefined","parsed","paddingLeft","margin","item","_unused3","fontWeight","split","line","handleSuggestionClick","s","background","minHeight","onClick","position","right","bottom","zIndex","src","alt","width","height","title","viewBox","cx","cy","r","stroke","strokeWidth","x1","y1","x2","y2","d","removeItem","strokeLinecap","strokeLinejoin","points","ref","justifyContent","tabIndex","max","border","cursor","fontSize","marginLeft","alignSelf","placeholder","onChange","target","onKeyDown","shiftKey","rows","overflow","resize","display"],"sources":["/workspaces/chatbot_test/snowflake-react-chat/src/components/ChatBot.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport '../styles/style.css';\nimport ChatbotIcon from '../assets/chatbot-toggler.png';\nimport ZSIcon from '../assets/ZS_Associates.png';\n\nconst HARDCODED_ANSWERS = {\n  \"where can i find top 10 gainer prescriber over time?\": \"Top 10 Gainer Prescribers can be found in the Performance Dossier.\",\n  \"what is formulary status?\": \"Formulary Status is the 'MMIT Pharmacy field which shows Preferred/Covered combined with PA/ST Restrictions.\",\n  \"what are the number of current monthly suggestion kpi?\": \"It is the 'Count of monthly suggestions (Call and RTE) for a prescriber.\",\n  \"which dossier gives a detailed analysis about the payors?\": \"You can find detailed analysis about Payor data in the Payor Highlights dossier.\",\n  \"where can i find explanations about different kpis?\": \"Explanations and Calculation of each and every KPI can be found in the Glossary dossier.\",\n  \"what is mkt % lis?\": \"Mkt % LIS in the Percentage of claims where claim type is 'PAID' and channel is 'Medicare' and 'Medicare D', and OPC = $0 - $12 and LIS patient flag = LIS-DE , LIS LTC, LIS-NON-DE, LIS-UNKNOWN for Rolling 3M.\",\n  \"which universes do we show in accounts calculation?\": \"We show three universes Veeva Aligned, Call Plan/DMCP and a combined Veeva Aligned + Call Plan/DMCP universes.\",\n  \"where can i find trx sales trends overtime?\": \"The sales trends for Retail and Non Retail sales can be found in the Performance Dossier.\"\n};\n\nconst HARDCODED_SUGGESTIONS = [\n  \"Which universes do we show in Accounts calculation?\",\n  \"Where can I find TRX Sales trends overtime?\",\n  \"Where can I find top 10 Gainer Prescriber over time?\",\n  \"What is Formulary Status?\"\n];\n\nconst GENERIC_GREETINGS = [\n  \"hi\", \"hello\", \"hey\", \"how are you\", \"good morning\", \"good afternoon\", \"good evening\",\n  \"hiya\", \"yo\", \"hii\", \"hello there\", \"hey there\", \"hi there\"\n];\n\nfunction isGreeting(text) {\n  const cleaned = text.trim().toLowerCase();\n  return GENERIC_GREETINGS.some(g => cleaned === g || cleaned.startsWith(g + ' '));\n}\n\nfunction formatSnowflakeResponse(responseText) {\n  try {\n    let json = JSON.parse(responseText);\n\n    if (\n      json.resultSetMetaData &&\n      json.resultSetMetaData.rowType &&\n      json.resultSetMetaData.rowType.length === 1 &&\n      /^CUSTOM_AGENT/i.test(json.resultSetMetaData.rowType[0].name) &&\n      Array.isArray(json.data) &&\n      json.data.length > 0 &&\n      json.data[0][0]\n    ) {\n      try {\n        const cellValue = json.data[0][0];\n        const agentObj = JSON.parse(cellValue);\n        if (typeof agentObj.output === \"string\") {\n          return { type: \"output\", value: agentObj.output };\n        }\n      } catch (e) {\n        return { type: \"output\", value: json.data[0][0] };\n      }\n    }\n\n    const agentKey = Object.keys(json).find(key => key.startsWith(\"CUSTOM_AGENT\"));\n    if (agentKey && typeof json[agentKey] === \"string\") {\n      try {\n        const agentObj = JSON.parse(json[agentKey]);\n        if (typeof agentObj.output === \"string\") {\n          return { type: \"output\", value: agentObj.output };\n        }\n        return { type: \"json\", value: agentObj };\n      } catch {\n        return { type: \"output\", value: json[agentKey] };\n      }\n    }\n\n    const columns =\n      (json.resultSetMetaData && json.resultSetMetaData.rowType && json.resultSetMetaData.rowType.map(col => col.name)) ||\n      (json.rowType && json.rowType.map(col => col.name)) ||\n      (json.rowtype && json.rowtype.map(col => col.name)) ||\n      (json.columns && json.columns.map(col => col.name));\n    const data = json.data;\n    if (Array.isArray(columns) && columns.length > 0 && Array.isArray(data)) {\n      return {\n        type: \"table\",\n        columns,\n        data\n      };\n    }\n\n    if (json.error) return { type: \"error\", value: \"‚ùå Error: \" + json.error };\n    if (\n      json.code &&\n      json.code !== \"000000\" &&\n      (!json.message || !json.message.toLowerCase().includes(\"executed successfully\"))\n    ) {\n      return { type: \"error\", value: `‚ùå Error: ${json.code} - ${json.message}` };\n    }\n    if (json.message) return { type: \"output\", value: json.message };\n\n    return { type: \"output\", value: \"No data found.\" };\n  } catch {\n    return { type: \"error\", value: responseText || \"No response from Snowflake.\" };\n  }\n}\n\n// --- Typing Indicator Component ---\nfunction TypingIndicator() {\n  return (\n    <span className=\"typing-indicator\">\n      <span></span><span></span><span></span>\n    </span>\n  );\n}\n\n// Tooltip helper\nconst Tooltip = ({ children, text }) => (\n  <span className=\"feedback-tooltip\">\n    {children}\n    <span className=\"feedback-tooltiptext\">{text}</span>\n  </span>\n);\n\nconst ChatBot = () => {\n  const [messages, setMessages] = useState(() => {\n    const saved = localStorage.getItem('chatMessages');\n    if (saved) return JSON.parse(saved);\n    return [{ role: 'assistant', text: 'Hello üëã! How may I assist you?' }];\n  });\n\n  const [feedback, setFeedback] = useState({});\n  const [suggestionIndex, setSuggestionIndex] = useState(() => {\n    const stored = localStorage.getItem('suggestionIndex');\n    return stored ? parseInt(stored, 10) : 0;\n  });\n  const [input, setInput] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [darkMode, setDarkMode] = useState(false);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [toast, setToast] = useState({ message: '', type: 'info', visible: false });\n  const [clickedIndex, setClickedIndex] = useState(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const chatRef = useRef();\n  const inputRef = useRef();\n\n  // Suggestion randomizer for clear chat\n  const randomizeSuggestions = () => {\n    let newIndex = Math.floor(Math.random() * HARDCODED_SUGGESTIONS.length);\n    if (HARDCODED_SUGGESTIONS.length > 1 && newIndex === suggestionIndex) {\n      newIndex = (newIndex + 1) % HARDCODED_SUGGESTIONS.length;\n    }\n    setSuggestionIndex(newIndex);\n    localStorage.setItem('suggestionIndex', newIndex.toString());\n  };\n\n  // 2 or 4 suggestions based on expansion\n  const numSuggestions = isExpanded ? 4 : 2;\n  const visibleSuggestions = Array(numSuggestions)\n    .fill(0)\n    .map((_, i) => HARDCODED_SUGGESTIONS[(suggestionIndex + i) % HARDCODED_SUGGESTIONS.length]);\n\n  // Scroll chat to bottom on update\n  useEffect(() => {\n    chatRef.current?.scrollTo({ top: chatRef.current.scrollHeight, behavior: 'smooth' });\n  }, [messages, isTyping, isOpen, isExpanded]);\n\n  // Prevent input scrolling\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.scrollLeft = inputRef.current.value.length * 8;\n    }\n  }, [input]);\n\n  // Auto-hide toast\n  useEffect(() => {\n    if (toast.visible) {\n      const timer = setTimeout(() => {\n        setToast(t => ({ ...t, visible: false }));\n      }, 1500);\n      return () => clearTimeout(timer);\n    }\n  }, [toast.visible]);\n\n  const showToast = (msg, type) => {\n    setToast({ message: msg, type: type, visible: true });\n  };\n\n  const handleSendMessage = async (userMessage) => {\n    if (!userMessage.trim()) return;\n    const newMessages = [...messages, { role: 'user', text: userMessage }];\n    setMessages(newMessages);\n    localStorage.setItem('chatMessages', JSON.stringify(newMessages));\n    setInput('');\n    setIsTyping(true);\n\n    if (isGreeting(userMessage)) {\n      const greetingResponse =\n        \"Hello! üëã How can I assist you with your field insights or business data today?\";\n      setTimeout(() => {\n        setIsTyping(false);\n        const updatedMessages = [...newMessages, { role: 'assistant', text: greetingResponse }];\n        setMessages(updatedMessages);\n        localStorage.setItem('chatMessages', JSON.stringify(updatedMessages));\n      }, 700);\n      return;\n    }\n\n    // HARDCODED business mode answers\n    const cleaned = userMessage.trim().toLowerCase();\n    const matchedKey = Object.keys(HARDCODED_ANSWERS).find(\n      k => cleaned.includes(k)\n    );\n    if (matchedKey) {\n      const hardcodedAnswer = HARDCODED_ANSWERS[matchedKey];\n      setTimeout(() => {\n        setIsTyping(false);\n        const updatedMessages = [...newMessages, { role: 'assistant', text: hardcodedAnswer }];\n        setMessages(updatedMessages);\n        localStorage.setItem('chatMessages', JSON.stringify(updatedMessages));\n      }, 650);\n      return;\n    }\n\n    // Show typing indicator (no pending message in chat)\n    const isLikelySQL = userMessage.trim().toLowerCase().startsWith('select')\n      || userMessage.trim().toLowerCase().startsWith('show')\n      || userMessage.trim().toLowerCase().startsWith('desc')\n      || userMessage.trim().toLowerCase().startsWith('describe');\n\n    try {\n      let body = isLikelySQL\n        ? { statement: userMessage }\n        : { statement: `CALL CUSTOM_AGENT2('${userMessage.replace(/'/g, \"''\")}');` };\n\n      const response = await fetch('http://localhost:4000/api/snowflake', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n      });\n      const responseText = await response.text();\n      const formatted = formatSnowflakeResponse(responseText);\n\n      setIsTyping(false);\n      const updatedMessages = [\n        ...newMessages,\n        {\n          role: 'assistant',\n          text: formatted,\n        }\n      ];\n      setMessages(updatedMessages);\n      localStorage.setItem('chatMessages', JSON.stringify(updatedMessages));\n    } catch (err) {\n      setIsTyping(false);\n      const formatted = { type: \"error\", value: \"‚ö†Ô∏è Unable to connect to backend.\" };\n      const updatedMessages = [...newMessages, { role: 'assistant', text: formatted }];\n      setMessages(updatedMessages);\n      localStorage.setItem('chatMessages', JSON.stringify(updatedMessages));\n    }\n  };\n\n  const handleFeedback = (idx, type) => {\n    setFeedback(prev => ({ ...prev, [idx]: type }));\n    showToast(type === \"up\" ? \"Marked as helpful!\" : \"Marked as not helpful!\", type === \"up\" ? \"success\" : \"error\");\n  };\n\n  const toggleTheme = () => setDarkMode(prev => !prev);\n\n  // Render assistant output\n  const renderChatBubbleContent = (msg) => {\n    if (typeof msg.text === \"object\" && msg.text !== null) {\n      const obj = msg.text;\n      if (obj.type === \"table\") {\n        return (\n          <table className=\"snowflake-table\">\n            <thead>\n              <tr>\n                {obj.columns.map((h, i) => <th key={i}>{h}</th>)}\n              </tr>\n            </thead>\n            <tbody>\n              {obj.data.length === 0 ? (\n                <tr>\n                  <td colSpan={obj.columns.length} style={{ textAlign: 'center', color: '#888' }}>(no results)</td>\n                </tr>\n              ) : obj.data.map((row, ridx) => (\n                <tr key={ridx}>\n                  {row.map((cell, cidx) => (\n                    <td key={cidx} style={{\n                      whiteSpace: 'pre-wrap',\n                      fontFamily: typeof cell === \"string\" && cell.trim().startsWith('[') ? \"monospace\" : undefined\n                    }}>\n                      {(() => {\n                        try {\n                          if (typeof cell === \"string\" && (cell.trim().startsWith('[') || cell.trim().startsWith('{'))) {\n                            const parsed = JSON.parse(cell);\n                            if (Array.isArray(parsed)) {\n                              return (\n                                <ul style={{ paddingLeft: '18px', margin: 0 }}>\n                                  {parsed.map((item, idx) => <li key={idx}>{item}</li>)}\n                                </ul>\n                              );\n                            }\n                            if (typeof parsed === 'object') {\n                              return <pre>{JSON.stringify(parsed, null, 2)}</pre>;\n                            }\n                          }\n                          return cell;\n                        } catch {\n                          return cell;\n                        }\n                      })()}\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        );\n      }\n      if (obj.type === \"output\") {\n        return <div>{obj.value}</div>;\n      }\n      if (obj.type === \"error\") {\n        return <span style={{ color: \"#b91c1c\", fontWeight: 500 }}>{obj.value}</span>;\n      }\n      return <pre>{JSON.stringify(obj.value, null, 2)}</pre>;\n    }\n    return (msg.text || \"\").split('\\n').map((line, i) => (\n      <div key={i}>{line}</div>\n    ));\n  };\n\n  // Suggestion button microinteraction\n  const handleSuggestionClick = (s, i, e) => {\n    setClickedIndex(i);\n    setTimeout(() => setClickedIndex(null), 220);\n    handleSendMessage(s);\n  };\n\n  // Main render\n  return (\n    <div style={{ background: 'linear-gradient(to bottom right, #f7faff, #e2ecf4)', minHeight: '100vh' }}>\n      <button\n        className=\"chatbot-toggler modern-toggler\"\n        onClick={() => setIsOpen(!isOpen)}\n        aria-label=\"Toggle chatbot\"\n        style={{ position: 'fixed', right: '20px', bottom: '20px', zIndex: 10000 }}>\n        {isOpen ? '‚úñ' : <img src={ChatbotIcon} alt=\"Chatbot\" style={{ width: 48, height: 48 }} />}\n      </button>\n      {isOpen && (\n        <div\n          className={\n            `chatbot modern-chatbot` +\n            (darkMode ? ' dark-mode' : '') +\n            (isExpanded ? ' expanded' : ' collapsed')\n          }\n        >\n          <header className=\"chatbot-header\">\n            <span className=\"header-title\">\n              Field Insights<span className=\"header-title-gradient\"> Assistant</span>\n            </span>\n            <div className=\"header-controls\">\n              <div className=\"header-actions\">\n                {/* Theme toggle */}\n                <button\n                  onClick={toggleTheme}\n                  title=\"Toggle theme\"\n                  className=\"header-action-btn\"\n                  aria-label=\"Toggle theme\"\n                >\n                  {darkMode ? (\n                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"none\">\n                      <circle cx=\"12\" cy=\"12\" r=\"5\" fill=\"#7c3aed\" />\n                      <g stroke=\"#7c3aed\" strokeWidth=\"2\">\n                        <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"5\" />\n                        <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"22\" />\n                        <line x1=\"4.22\" y1=\"4.22\" x2=\"6.34\" y2=\"6.34\" />\n                        <line x1=\"17.66\" y1=\"17.66\" x2=\"19.78\" y2=\"19.78\" />\n                        <line x1=\"2\" y1=\"12\" x2=\"5\" y2=\"12\" />\n                        <line x1=\"19\" y1=\"12\" x2=\"22\" y2=\"12\" />\n                        <line x1=\"4.22\" y1=\"19.78\" x2=\"6.34\" y2=\"17.66\" />\n                        <line x1=\"17.66\" y1=\"6.34\" x2=\"19.78\" y2=\"4.22\" />\n                      </g>\n                    </svg>\n                  ) : (\n                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"none\">\n                      <path d=\"M21 12.79A9 9 0 1111.21 3a7 7 0 0010.02 9.79z\" fill=\"#7c3aed\" />\n                    </svg>\n                  )}\n                </button>\n                {/* Refresh/Clear + randomize suggestions */}\n                <button\n                  onClick={() => {\n                    randomizeSuggestions();\n                    setMessages([{ role: 'assistant', text: 'Hello üëã! How may I assist you?' }]);\n                    localStorage.removeItem('chatMessages');\n                    setFeedback({});\n                  }}\n                  title=\"Clear chat\"\n                  className=\"header-action-btn\"\n                  aria-label=\"Clear chat\"\n                >\n                  <svg width=\"25\" height=\"25\" fill=\"none\" stroke=\"#7c3aed\" strokeWidth=\"2.1\" viewBox=\"0 0 24 24\">\n                    <path d=\"M4.93 4.93a10 10 0 1014.14 0M23 4v6h-6\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                  </svg>\n                </button>\n                {/* Expand/Collapse */}\n                <button\n                  onClick={() => setIsExpanded((prev) => !prev)}\n                  title={isExpanded ? 'Collapse window' : 'Expand window'}\n                  className=\"header-action-btn\"\n                  aria-label={isExpanded ? 'Collapse window' : 'Expand window'}\n                >\n                  {isExpanded ? (\n                    <svg width=\"25\" height=\"25\" fill=\"none\" stroke=\"#7c3aed\" strokeWidth=\"2.1\" viewBox=\"0 0 24 24\">\n                      <polyline points=\"8 3 3 3 3 8\" />\n                      <line x1=\"3\" y1=\"3\" x2=\"10\" y2=\"10\" />\n                      <polyline points=\"16 21 21 21 21 16\" />\n                      <line x1=\"21\" y1=\"21\" x2=\"14\" y2=\"14\" />\n                    </svg>\n                  ) : (\n                    <svg width=\"25\" height=\"25\" fill=\"none\" stroke=\"#7c3aed\" strokeWidth=\"2.1\" viewBox=\"0 0 24 24\">\n                      <polyline points=\"15 3 21 3 21 9\" />\n                      <line x1=\"21\" y1=\"3\" x2=\"14\" y2=\"10\" />\n                      <polyline points=\"9 21 3 21 3 15\" />\n                      <line x1=\"3\" y1=\"21\" x2=\"10\" y2=\"14\" />\n                    </svg>\n                  )}\n                </button>\n              </div>\n            </div>\n          </header>\n          <ul className=\"chatbox\" ref={chatRef}>\n            {messages.map((msg, idx) => (\n              <li\n                key={idx}\n                className={`chat ${msg.role === 'user' ? 'outgoing' : 'incoming'}`}\n                style={{\n                  justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start',\n                }}\n              >\n                <div className={`chat-bubble ${msg.role}`}>\n                  {renderChatBubbleContent(msg)}\n                </div>\n                {msg.role === 'assistant' && (\n                  <div className=\"feedback-row\">\n                    {feedback[idx] === undefined && (\n                      <>\n                        <Tooltip text=\"Mark as helpful\">\n                          <button\n                            className=\"feedback-btn\"\n                            onClick={() => handleFeedback(idx, 'up')}\n                            aria-label=\"Thumbs up\"\n                            tabIndex={0}\n                          >üëç</button>\n                        </Tooltip>\n                        <Tooltip text=\"Mark as not helpful\">\n                          <button\n                            className=\"feedback-btn\"\n                            onClick={() => handleFeedback(idx, 'down')}\n                            aria-label=\"Thumbs down\"\n                            tabIndex={0}\n                          >üëé</button>\n                        </Tooltip>\n                      </>\n                    )}\n                    {feedback[idx] === 'up' && (\n                      <Tooltip text=\"Marked as helpful!\">\n                        <button className=\"feedback-btn selected up\" aria-label=\"Thumbs up\" tabIndex={0}>üëç</button>\n                      </Tooltip>\n                    )}\n                    {feedback[idx] === 'down' && (\n                      <Tooltip text=\"Marked as not helpful\">\n                        <button className=\"feedback-btn selected down\" aria-label=\"Thumbs down\" tabIndex={0}>üëé</button>\n                      </Tooltip>\n                    )}\n                  </div>\n                )}\n              </li>\n            ))}\n            {/* Typing indicator */}\n            {isTyping && (\n              <li className=\"chat incoming\">\n                <div className=\"chat-bubble assistant\">\n                  <TypingIndicator />\n                </div>\n              </li>\n            )}\n          </ul>\n          {/* Suggestions panel now at the bottom */}\n          <div className=\"suggestions\" style={{ position: \"relative\" }}>\n            {visibleSuggestions.map((s, i) => (\n              <button\n                key={i}\n                onClick={e => handleSuggestionClick(s, i, e)}\n                className={`suggestion-button${clickedIndex === i ? ' clicked' : ''}`}\n              >\n                {s}\n              </button>\n            ))}\n            { !isExpanded &&\n              <button\n                className=\"suggestion-arrow right\"\n                aria-label=\"Next suggestions\"\n                onClick={() => {\n                  const max = HARDCODED_SUGGESTIONS.length;\n                  setSuggestionIndex((prev) => (prev + 1) % max);\n                  localStorage.setItem(\n                    \"suggestionIndex\",\n                    ((suggestionIndex + 1) % max).toString()\n                  );\n                }}\n                style={{\n                  border: \"none\",\n                  background: \"none\",\n                  cursor: \"pointer\",\n                  fontSize: 20,\n                  marginLeft: 7,\n                  color: \"#7c3aed\",\n                  alignSelf: \"center\",\n                  height: 28,\n                  width: 28\n                }}\n              >&#8594;</button>\n            }\n          </div>\n          <div className=\"chat-input\">\n            <textarea\n              ref={inputRef}\n              placeholder=\"Ask me anything...\"\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && handleSendMessage(input)}\n              rows={1}\n              className=\"chat-input-textarea\"\n              style={{overflow: 'hidden', resize: 'none'}}\n            />\n            <button\n              onClick={() => handleSendMessage(input)}\n              title=\"Send message\"\n              className={`send-button${input.trim() ? \" has-text\" : \"\"}`}\n            >\n              {/* SVG send icon */}\n              <svg height=\"22\" width=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" style={{display:\"block\"}}>\n                <path d=\"M4 20L20 12L4 4V10L16 12L4 14V20Z\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n          {/* Toast notification inside chatbox */}\n          {toast.visible && (\n            <div\n              className={`toast toast-${toast.type}`}\n              onClick={() => setToast(t => ({ ...t, visible: false }))}\n              style={{cursor:'pointer'}}\n            >\n              {toast.message}\n            </div>\n          )}\n          <footer className=\"chatbot-footer\">\n            Powered by <img src={ZSIcon} alt=\"ZS Associates\" />\n          </footer>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ChatBot;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}